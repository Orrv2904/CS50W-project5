{% extends 'pos/layout.html' %}
{% load static %}
{% block content %}

<!-- partial -->
{% block navbar %}
{% include "pos/nav.html" %}
{% endblock %}

<div class="content">
  <form id="presentationForm" method="post" enctype="multipart/form-data" class="container">
    {% csrf_token %}
    <h1 class="text-center my-4">Welcome {{ user }}</h1>

    <div class="form-group">
      <label for="name" class="mt-3 fw-bold fs-5">Name:</label>
      <input type="text" id="name" name="name" required class="form-control mt-1 mb-3">
    </div>

    <div class="form-group">
      <label for="description" class="fw-bold fs-5 ">Description:</label>
      <textarea id="description" name="description" required class="form-control mt-1 mb-3"></textarea>
    </div>

    <div class="form-group mt-4">
      <label for="status" class="fw-bold fs-5 ">Status:</label>
      <input type="checkbox" id="status" name="status" checked class="form-check-input mt-1 mb-3 ms-3">
    </div>

    <div class="d-flex justify-content-center mt-3 mb-6">
      <input type="submit" class="btn btn-primary" value="Submit">
    </div>
  </form>

  <div class="card border-light shadow-sm mb-4">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-centered table-nowrap mb-0 rounded">
          <thead class="thead-light">
            <tr>
              <th class="border-0">#</th>
              <th class="border-0">Name</th>
              <th class="border-0">Description</th>
              <th class="border-0">Status</th>
              <th class="border-0">Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- Item -->
            {% for i in data %}
            <tr>
              <td class="border-0"><a href="#" class="text-primary font-weight-bold">{{ i.id }}</a> </td>
              <td class="border-0">
                {{ i.name }}
              </td>
              <td class="border-0">
                {{ i.description }}
              </td>
              <td class="border-0">
                {{ i.status }}
              </td>

              <td class="border-0 text-success">
                <span class="fas fa-angle-up"></span>
                <span class="font-weight-bold">2.45%</span>
              </td>
            </tr>
            {% endfor %}
            <!-- End of Item -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>



<!-- partial -->

<script>
  document.getElementById('presentationForm').addEventListener('submit', function (event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const data = {
      name: formData.get('name'),
      description: formData.get('description'),
      status: formData.get('status') === 'on'  // El checkbox se convierte a boolean
    };

    fetch('/create_presentation/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCookie('csrftoken')  // Necesitas manejar CSRF Token
      },
      body: JSON.stringify(data)
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: data.message
          }).then(() => {
            location.reload();
          });;
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Error: ' + data.message
          }).then(() => {
            location.reload();
          });;
          console.log(data.errors);
        }
      })
      .catch(error => console.error('Error:', error));
  });

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

{% endblock %}