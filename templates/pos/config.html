{% extends 'pos/layout.html' %}
 {% load static %}
 {% block content %}

 <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
   
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
     
      <!-- partial -->
      <!-- partial:partials/_sidebar.html -->
      {% block navbar %}
        {% include "pos/nav.html" %}
      {% endblock %}
      <!-- partial -->

      <div class="main-panel card" style="background-color:#b9b3a9">
        <form action="{% url 'config' %}" method="post" enctype="multipart/form-data" class="container">
          {% csrf_token %}
            <h1 class="d-flex justify-content-center" style="margin-top: 3rem; font-weight: bold;">Settings</h1>
  
            <div class="form-group container formula">
              <label for="systemname" style="margin-top: 1rem; font-weight: bold; font-size: large;">System name: </label>
              <input type="text" id="systemname" name="systemname" required style="margin-top: 1rem;" class="form-control"> 
            </div>

            <div class="form-group container formula">
              <label for="Image" style="font-weight: bold; font-size: large;" >Image:</label>
              <input type="file" id="image" name="image" accept="image/*" required style="margin-top: 3rem;" >
            </div>

            <div class="form-group container formula">
              <label for="address" style="margin-top: 1rem; font-weight: bold; font-size: large;">Address: </label>
              <textarea id="address" name="address" required style="margin-top: 1rem;" class="form-control"></textarea>
            </div>

            <div class="form-group container formula">
              <label for="phone" style="margin-top: 1rem; font-weight: bold; font-size: large;">Phone: </label>
              <input type="number" id="phone" name="phone" required style="margin-top: 1rem;" class="form-control" maxlength="8" minlength="8"> 
            </div>

            <div class="form-group container formula">
              <label for="exchange" style="font-weight: bold; font-size: large;" >Exchange:</label>
              <input type="number" id="exchange" name="exchange" required style="margin-top: 1rem;" class="form-control">
            </div>

            <div class="form-group container formula">
              <label for="status" style="font-weight: bold; font-size: large;" >Status:</label>
              <input type="checkbox" id="status" name="status" checked style="margin-top: 1rem;" class="form-control">
            </div>
  
            <div class="d-flex justify-content-center" style="margin-top: 3rem;">
              <input type="submit" class="btn btn-primary" value="Submit">
            </div>

        </form>
      </div>
                
  
    </div>
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <!-- partial -->
</div>

      <script>
        document.getElementById('configForm').addEventListener('submit', function (event) {
          event.preventDefault();
  
          const formData = new FormData(event.target);
          const data = {
            systemname: formData.get('systemname'), // Cambiado el nombre del campo
            Image: formData.get('image'),
            address: formData.get('address'),
            phone: formData.get('phone'),
            exchange: formData.get('exchange'),
          };
  
          fetch('/update_config/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': getCookie('csrftoken')  // Necesitas manejar CSRF Token
            },
            body: JSON.stringify(data)
          })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                Swal.fire({
                  icon: 'success',
                  title: 'Success!',
                  text: data.message
                });
              } else {
                Swal.fire({
                  icon: 'error',
                  title: 'Oops...',
                  text: 'Error: ' + data.message
                });
                console.log(data.errors);
              }
            })
            .catch(error => console.error('Error:', error));
        });
  
        function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
              }
            }
          }
          return cookieValue;
        }
  
      </script>
      
{% endblock %}